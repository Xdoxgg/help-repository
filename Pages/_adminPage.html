<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление данными</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
<h1>Управление данными</h1>

<h2>Выберите таблицу</h2>
<select id="tableSelector" onchange="fetchData()">
    <option value="teams_data">Команды</option>
    <option value="characters">Персонажи</option>
    
    <option value="team_to_character">Связь команд и персонажей</option>
    <option value="users">Пользователи</option>
</select>

<h2>Данные</h2>
<table id="dataTable">
    <thead>
    <tr id="tableHeader">
        <!-- Заголовки таблицы будут заполнены здесь -->
    </tr>
    </thead>
    <tbody>
    <!-- Данные будут заполнены здесь -->
    </tbody>
</table>

<script>
    async function fetchData() {
        const tableSelector = document.getElementById('tableSelector');
        const selectedTable = tableSelector.value;
        let response, data;
        try {
            response = await fetch(`/api/${selectedTable}`);
            if (!response.ok) {
                throw new Error('Ошибка сети: ' + response.statusText);
            }

            data = await response.json();
            console.log('Полученные данные:', data); // Отладка: выводим данные в консоль
            updateTable(data);
        } catch (error) {
            console.error('Ошибка при получении данных:', error);
        }
    }

    function updateTable(data) {
        const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const tableHeader = document.getElementById('tableHeader');

        // Очистка предыдущих данных
        tableBody.innerHTML = '';
        tableHeader.innerHTML = '';

        // Проверяем, есть ли данные
        if (data.length === 0) {
            console.warn('Нет данных для отображения');
            return;
        }

        // Получаем заголовки из первого объекта данных
        const headers = Object.keys(data[0]);

        // Заполнение заголовков таблицы
        headers.forEach(header => {
            const th = document.createElement('th');
            th.innerText = header.charAt(0).toUpperCase() + header.slice(1); // Делаем первую букву заглавной
            tableHeader.appendChild(th);
        });

        // Заполнение данных таблицы
        data.forEach(item => {
            const row = tableBody.insertRow();
            headers.forEach(header => {
                const cell = row.insertCell();
                cell.innerText = item[header] !== undefined ? item[header] : ''; // Проверяем наличие ключа
            });
        });
    }

    window.onload = fetchData;
</script>
</body>
</html>